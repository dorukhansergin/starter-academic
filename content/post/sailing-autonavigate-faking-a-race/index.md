---
# Documentation: https://wowchemy.com/docs/managing-content/

title: "Sailing Autonavigate Faking a Race"
subtitle: ""
summary: ""
authors: []
tags: []
categories: []
date: 2021-01-28T06:33:19-07:00
lastmod: 2021-01-28T06:33:19-07:00
featured: false
draft: true

# Featured image
# To use, add an image named `featured.jpg/png` to your page's folder.
# Focal points: Smart, Center, TopLeft, Top, TopRight, Left, Right, BottomLeft, Bottom, BottomRight.
image:
  caption: ""
  focal_point: ""
  preview_only: false

# Projects (optional).
#   Associate this post with one or more of your projects.
#   Simply enter your project's folder or file name without extension.
#   E.g. `projects = ["internal-project"]` references `content/project/deep-learning/index.md`.
#   Otherwise, set `projects = []`.
projects: []
---
{{% callout note %}}
This is the third post on the series that explains the side project I just started working on: Sailing Autonavigate. If you haven't done so, I suggest reading the frist two posts([1]({{< ref "/post/sailing-autonavigate-kickoff/index.md" >}}),[2]({{< ref "/post/sailing-autonavigate-the-problem/index.md" >}})) to understand the context behind it.
{{% /callout %}}

In [the last post]({{< ref "/post/sailing-autonavigate-the-problem/index.md" >}}), we translated the problem into mathematical terms, only to find out that we cannot simply solve it analytically. That brought us to start thinking about numerical based alterantives. Then we ended the post with two open questions. I will try to answer the first of those two in this one. In other words, how to *fake a sailing race* on a computer?

Roughly speaking, there are two mechanics we have to figure out when it comes to faking a sailing race: (1) how the wind blows, (2) how the boat sails. Let's start from the latter.

# The Sailing Mechanics of a Boat
After plotting a navigation course, the skipper knows which direction on the compass (a.k.a the heading) she wants to go to. She plays with the rudder (the equivalent of steering wheel in boats) to keep the boat on a straight line while making sure to not the lose momentum gained by the force generated by the wind. We are not interested in the fine adjustments to the rudder and will assume that the skipper is a professional so she always sails the boat in the most optimum conditions. Once that's out of the way, we have to figure out how to calculate what is the velocity of the boat at any given moment and how to advance the coordinates of the boat accordingly.

{{< figure src="compass.jpeg" title="A compass fixed on the deck of boat to provide visual feedback to the helmsman. Photo Credit: [Griffing Wooldrige](https://unsplash.com/@dzngriffin)" >}}

Assume that we know the angle and the speed of the wind acting on a boat that is at a specific location on the Earth at a specific time. We also know the heading of the boat with which we can calculate the angle of the wind relative to the boat. A polar diagram is a lookup table given to each boat as a reference to figure out what would the velocity of the boat be given these two pieces of information: the wind speed and the relative angle of the wind. I encourage you to take a look at the visualizations at the beautiful [ORC sailboat data website](http://jieter.github.io/orc-data/site/).

If the Earth was flat (as some people still believe in), the approximation of boat's movement would be easy. Following the notation from [the last post]({{< ref "/post/sailing-autonavigate-the-problem/index.md" >}}), assume that the instantaneous velocity of a boat at time $t$ is denoted by $v(x(t), u(t), t)$. Then we need to fix a time step length (e.g. a minute), let's call this $dt$, in which we assume the observed wind at time $t$ will not change significantly, neither in terms of speed nor angle. So the boat will be going at a constant velocity at a specific direction for a $dt$ amount of time. As long as this $dt$ is small enough, we can get a pretty good approximation of the trajectory we would otherwise had to solve a integral for.

$$
x(t+dt) = x(t) + v(x(t), u(t), t) * dt
$$

But the world is not flat and coordinates on the surface are not described in the cartesian space. A location on the surface of the Earth is described by spherical coordinates where the three coordinates describe the latitude (or the angular distance from the Equator), the longitude (or the angular distance from the prime meridian), and the radius (distance from the core of the Earth). Radius is often ignored because how far are we from the core of the Earth is not very interesting for our daily lives. That leaves us with the latitude and longitude.

I want the boat mechanics to be as realistic as possible. This is why I made some research into the math behind important trajectory calculations in latitude and longitude. Whichever method I use, I should be able to give an answer to the following questions:
> Given a starting latitude-longitude and a heading, at which coordinate I will end up at if I sail at that heading with a certain velocity for a certain amount of time?

With this question in mind, my research led me to three major methods. I'm pretty sure there are other ways to answer the question above but I decided to keep it short and sweet at this point.

## Method 1: Projection using Universal Transverse Mercator
When we stand out in the field, the surface of the Earth looks flat to us. The idea behind projection is that we come up with a 2D surface that we can map each and every point on the surface of the Earth onto it. If this new surface is in Cartesian coordinates, we can apply the above formula and re-project the new coordinates back to latitude and longitude.

The famous Mercator projection assumes a cylinder that wraps up the Earth and projects every point on Earth on the cylinder. The cylinder then can bu unwrapped just like page and we end up with that famous atlas view. However, the projection is not without errors. See the map below and how gross the errors get as we move closer the poles. As a mental exercise, think about the poles and how in this projection, they are inflated from one single point to a line that is as long as the Equator.

{{< figure src="https://upload.wikimedia.org/wikipedia/commons/e/ee/Worlds_animate.gif" title="Proportions of apparent size and real size (animated). By Jakub Nowosad - Own work, CC BY-SA 4.0, https://commons.wikimedia.org/w/index.php?curid=73955926" >}}

There are better ways than using a single projection to project an entire globe. The larger the area, the larger the distortion in distance and area is. I will pick one of them, the Universal Transverse Mercator (UTM) Coordinate Reference System (CRS) and explain that as a candidate method. If you are interested in more, I suggest [this page from QGIS Documentation](https://docs.qgis.org/3.16/en/docs/gentle_gis_introduction/coordinate_reference_systems.html) which I personally found very useful. In that page, the motivation behind UTM CRS is described as follows:
> [...] But as already described in the section ‘accuracy of map projections’ above, the larger the area (for example South Africa) the more distortion of angular conformity, distance and area occur. To avoid too much distortion, the world is divided into 60 equal zones that are all 6 degrees wide in longitude from East to West.

The implication of this for our use case is that, at every time $t$, we figure out which UTM zone the coordinates of the boat fall into, project the coordinates to the Cartesian space and advance the boat. Using the same CRS, we reproject back to the latitude-longitude coordinates. At the next step, if we are in a new zone, we can switch the projection logic. However, given the typical speeds of sailing vessels and how large UTM zones are, this is going to be rare. According to [this source](https://www.e-education.psu.edu/natureofgeoinfo/c2_p22.html), within any UTM zone, distortion should be expected within 1 meter range (plur or minus) in a 1000 meter distance. This sounds acceptable to me.

## Method 2: Great-circle or Haversine Formulas
What if we didn't have to deal with Cartesian coordinates at all? This is where haversine formulas come into play. The major assumption here is that Earth is a perfect sphere, that is, not matter where you are, the distance from the core of the Earth to the surface is the same. If that is the case, you can use [the related haversine formulation](https://www.movable-type.co.uk/scripts/latlong.html#dest-point) to calculate your destination point given your heading and the distance travelled from your initial location.

Note that the radius of the sphere is fixed in those formulation, which comes from the assumption that the Earth is a perfect sphere. This is clearly not true since we know the distance gets smaller as you move from the Equator to the Poles. So we expect distortions. According [to this source](https://blog.mapbox.com/fast-geodesic-approximations-with-cheap-ruler-106f229ad016), the error can go up to 0.5% with haversine formula. Note that this was around 0.1% with the projection method.

{{< figure src="https://users.cs.jmu.edu/bernstdh/web/common/lectures/images/great-circle-distance.gif" title="Illustration of great circle distance. Taken from [Great Circle Distances for a Spherical Planet, by Prof. David Bernstein](https://users.cs.jmu.edu/bernstdh/web/common/lectures/summary_great-circle-distance_spherical.php)" >}}

## Method 3: Vincenty's Formula
Named after Thaddeus Vincenty, this iterative method provides the most precise calculation so far, a whooping +-0.5mm accuracy in distance calculations. Despite being an iterative method, it also converges fast if the points are not extremely far away from each other. Since we are modelling incremental time steps, it should be okay to use.

If you are interested in learning more, I suggest looking at [this informative page](https://www.movable-type.co.uk/scripts/latlong-vincenty.html).






